<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>County Colorer</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.26.2/full/pyodide.js"></script>
</head>

<body>
    <h1>County Colorer</h1>

    <label for="state">State/Territory to Color: </label>
    <select id="state">
        <optgroup label="States">
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">Sotuh Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
        </optgroup>
        <optgroup label="Territories">
            <option value="AS">American Samoa</option>
            <option value="DC">District of Columbia</option>
            <option value="GU">Guam</option>
            <option value="MP">Northern Mariana Islands</option>
            <option value="PR">Puerto Rico</option>
            <option value="VI">US Virgin Islands</option>
        </optgroup>
    </select><br><br>

    <label for="colors">Number of Colors (4 or 5 recommended):</label>
    <input id="colors" type="number" min="3" max="10" value="4"><br><br>

    <button onclick="runColoring()">Run</button>

    <!-- Create pre-formatted text block for results to be added to and be displayed -->
    <pre id="output"></pre>

    <script type="text/javascript">
        // Pyodide is a WebAssembly-based version of Python that runs directly in the browser
        let pyodideReadyPromise = loadPyodide();

        // Pyodide runs asynchronously (needs to use 'await') so function needs to be async
        async function runColoring() {
            // Wait for Pyodide to be fully loaded
            const pyodide = await pyodideReadyPromise;

            // Load county adjacency data file into Pyodide's in-memory file system
            const dataResponse = await fetch("county_adjacency2025.txt");
            const dataText = await dataResponse.text();  // read fetched file as text
            // Write file into Pyodideâ€™s virtual file system, so Python code running inside Pyodide can access it as if it were a real file
            pyodide.FS.writeFile("county_adjacency2025.txt", dataText);

            // Load colorer.py into Pyodide's in-memory file system, just as we did with county adjacency data
            const response = await fetch("colorer.py");
            const code = await response.text();
            pyodide.FS.writeFile("colorer.py", code);

            // Run enclosed Python code in browser
            await pyodide.runPythonAsync(`
            from colorer import load_county_data, color_state_counties

            state = "${document.getElementById('state').value}"
            color_number = int(${document.getElementById('colors').value})
            county_borders, states = load_county_data()

            if state not in states:
                result = f"Error: {state} is not a valid state abbreviation."
            else:
                colors, success = color_state_counties(state, color_number, county_borders)
                if success:
                    result = f"Successfully colored all counties in {state}!\\n\\nColor Assignments:\\n{colors}"
                else:
                    result = f"Could not color all counties in {state} with {color_number} colors."
            `);

            // Retrieves Python variable "result" from Pyodide's global scope and displays it in the "pre" block defined earlier
            document.getElementById("output").textContent = pyodide.globals.get("result");
        }
    </script>
</body>

</html>